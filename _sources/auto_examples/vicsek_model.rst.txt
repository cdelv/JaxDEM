
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/vicsek_model.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_vicsek_model.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_vicsek_model.py:


This is an implementation of the Vicsek model in 2D.
A state is created with 200 particles in periodic boundaries,
each interacting via a pairwise purely-repulsive harmonic potential.
Particles move with a constant velocity ```v0``` in a direction that
is set by a random component proportional to ```eta``` and another
component proportional to the average velocity of all neighboring
particles within a distance ```neighbor_radius```.  In this
implementation, the random vector noise characterizes this
as an "extrinsic" noise Vicsek model, as opposed to the "intrinsic"
noise variant.  We use a ```trajectory_rollout``` to run the dynamics
using a jit-compiled loop, which also returns the trajectory data.
We then calculate the polarization order parameter (norm of the
average velocity vectors) for each saved frame.

.. GENERATED FROM PYTHON SOURCE LINES 17-26

.. code-block:: Python


    import jax
    jax.config.update("jax_enable_x64", True)  # set f64 precision!
    import jax.numpy as jnp
    import jaxdem as jd
    import numpy as np

    from jaxdem.utils.randomSphereConfiguration import random_sphere_configuration








.. GENERATED FROM PYTHON SOURCE LINES 27-28

This function sets the initial data

.. GENERATED FROM PYTHON SOURCE LINES 28-73

.. code-block:: Python


    def build_microstate(N, phi, dim, dt, neighbor_radius, eta, v0, seed):
        # important to set this to be large enough such that the collider does not overflow
        max_neighbors = 64

        # Mono-disperse radii
        particle_radii = jd.utils.dispersity.get_polydisperse_radii(N, [1.0], [1.0])

        pos, box_size = random_sphere_configuration(particle_radii, phi, dim, seed)

        state = jd.State.create(
            pos=pos,
            rad=particle_radii,
            mass=jnp.ones(N),
        )

        mats = [jd.Material.create("elastic", young=1.0, poisson=0.5, density=1.0)]
        matcher = jd.MaterialMatchmaker.create("harmonic")
        mat_table = jd.MaterialTable.from_materials(mats, matcher=matcher)

        system = jd.System.create(
            state_shape=state.shape,
            dt=dt,
            # Vicsek integrator:
            linear_integrator_type="vicsek_extrinsic",
            linear_integrator_kw=dict(
                neighbor_radius=jnp.asarray(neighbor_radius, dtype=float),
                eta=jnp.asarray(eta, dtype=float),
                v0=jnp.asarray(v0, dtype=float),
                max_neighbors=max_neighbors,
            ),
            rotation_integrator_type="",
            domain_type="periodic",
            domain_kw=dict(box_size=box_size),
            force_model_type="spring",
            mat_table=mat_table,
            # here, we use the naive (double for-loop) collider since the system is small;
            # if you were to use a larger system, we recommend using the StaticCellList
            # or potentially the NeighborList
            collider_type="naive",
            seed=seed,
        )
        return state, system









.. GENERATED FROM PYTHON SOURCE LINES 74-75

Build the initial data

.. GENERATED FROM PYTHON SOURCE LINES 75-101

.. code-block:: Python

    state, system = build_microstate(
        N=200,  # 200 particles
        phi=0.65,  # just dense enough to order
        dim=2,  # 2D
        dt=1e-2,  # semi-arbitrary timestep
        neighbor_radius=1.0,  # particles will align within 2x their radii
        eta=0.2,  # small noise component
        v0=1.0,  # semi-arbitrary velocity
        seed=np.random.randint(0, 1e9)  # random seed
    )

    # Run the dynamics for 5K steps, saving every 50th
    n_steps = 5_000
    save_stride = 50
    n_frames = n_steps // save_stride

    state_f, system_f, (traj_state, traj_system) = jd.System.trajectory_rollout(
        state,
        system,
        n=n_frames,
        stride=save_stride,
    )

    polarization = jnp.linalg.norm(jnp.mean(traj_state.vel, axis=-2), axis=-1)
    print("Polarization:")
    print(polarization)




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Polarization:
    [0.45061843 0.59310892 0.81905143 0.85180219 0.90945553 0.91979652
     0.93503201 0.9238821  0.92018284 0.93923613 0.95080108 0.95120668
     0.92535937 0.90319078 0.93908055 0.9490907  0.92597922 0.93116479
     0.94229065 0.90725873 0.92793197 0.90910529 0.93878496 0.93365939
     0.9289553  0.928164   0.95284398 0.94574112 0.91609993 0.94231586
     0.93058739 0.93378664 0.95492198 0.94651142 0.94904745 0.93693496
     0.95420721 0.95149837 0.9329047  0.90100072 0.94611877 0.93941558
     0.94567335 0.92125573 0.93239635 0.90748502 0.95072824 0.93997575
     0.9392236  0.93928973 0.9329311  0.94570786 0.91058845 0.94923269
     0.94180165 0.95411073 0.94559454 0.92442791 0.94479128 0.93955693
     0.95468447 0.88365318 0.9467231  0.93659851 0.96065718 0.92978148
     0.92050287 0.91468264 0.93216947 0.92898337 0.94253901 0.89864514
     0.92358941 0.94680531 0.93559915 0.92487432 0.93176435 0.92934825
     0.91472682 0.91215049 0.90676978 0.90296938 0.92658475 0.94341074
     0.94964295 0.94663794 0.94199386 0.93585744 0.95977499 0.94652378
     0.96131282 0.9288814  0.92568549 0.88488237 0.90386035 0.90873345
     0.94365956 0.95560073 0.93707498 0.94024729]





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 16.491 seconds)


.. _sphx_glr_download_auto_examples_vicsek_model.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: vicsek_model.ipynb <vicsek_model.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: vicsek_model.py <vicsek_model.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: vicsek_model.zip <vicsek_model.zip>`
