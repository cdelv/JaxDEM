
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Imports &#8212; JaxDEM</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=039bb74b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=8a448e45"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/temperature_density_control';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">JaxDEM</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contribution_guide/index.html">
    Contribution Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/api.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cdelv/JaxDEM" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contribution_guide/index.html">
    Contribution Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/api.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/cdelv/JaxDEM" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fab fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items" aria-labelledby="pst-indices-navigation-heading-2">
  <p id="pst-indices-navigation-heading-2" class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Imports</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-temperature-density-control-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<p class="sphx-glr-example-title" id="sphx-glr-auto-examples-temperature-density-control-py">Example: temperature and density control via simple rescaling.</p>
<p>This script builds a small periodic system of spheres, initialized at a low temperature,
and then runs dynamics while imposing a <em>time-dependent packing fraction</em>
using <cite>jd.utils.control_nvt_density_rollout</cite>.  This function can modulate both the
temperature and density of the system using very simple rescaling.
It comes in two variants, one with _rollout and one without.  The _rollout
variant provides access to the intermediate trajectory data, whereas the other
does not.  Although it may be convenient to get the trajectory data,
the non _rollout option is higher performance.</p>
<p>In either, we can set a target temperature and/or density and the control_nvt_density
function will use a linear scheduler to reach the desired set point after a set
number of steps.</p>
<p>You can also control either variable using a custom scheduler.  Here, we show
an example of that.  We modulate the density according to a single sine wave.</p>
<p>In this example we:
- <strong>Modulate density</strong> (packing fraction) with a prescribed schedule.
- <strong>Do not thermostat</strong> (temperature is allowed to fluctuate in response to compression).</p>
<section id="imports">
<h1>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jaxdem</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jaxdem.utils.randomSphereConfiguration</span><span class="w"> </span><span class="kn">import</span> <span class="n">random_sphere_configuration</span>

<span class="c1"># We need to enable double precision for accuracy in cold systems</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parameters">
<h1>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h1>
<p>Background:
We build a single system in the same spirit as <cite>examples/jam_spheres.py</cite>:
- choose a polydisperse radius distribution
- generate a random, overlap-free configuration at the desired packing fraction <cite>phi</cite>
- create a periodic <cite>System</cite> with a simple spring contact model</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">e_int</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-2</span>

<span class="n">can_rotate</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># smooth spheres cannot rotate</span>
<span class="n">subtract_drift</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_microstate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">e_int</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1e-2</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">particle_radii</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dispersity</span><span class="o">.</span><span class="n">get_polydisperse_radii</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>
    <span class="n">pos</span><span class="p">,</span> <span class="n">box_size</span> <span class="o">=</span> <span class="n">random_sphere_configuration</span><span class="p">(</span><span class="n">particle_radii</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
        <span class="n">rad</span><span class="o">=</span><span class="n">particle_radii</span><span class="p">,</span>
        <span class="n">mass</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">mass</span>
    <span class="p">)</span>
    <span class="n">mats</span> <span class="o">=</span> <span class="p">[</span><span class="n">jd</span><span class="o">.</span><span class="n">Material</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;elastic&quot;</span><span class="p">,</span> <span class="n">young</span><span class="o">=</span><span class="n">e_int</span><span class="p">,</span> <span class="n">poisson</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)]</span>
    <span class="n">matcher</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">MaterialMatchmaker</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;harmonic&quot;</span><span class="p">)</span>
    <span class="n">mat_table</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">MaterialTable</span><span class="o">.</span><span class="n">from_materials</span><span class="p">(</span><span class="n">mats</span><span class="p">,</span> <span class="n">matcher</span><span class="o">=</span><span class="n">matcher</span><span class="p">)</span>
    <span class="n">system</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">state_shape</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">linear_integrator_type</span><span class="o">=</span><span class="s2">&quot;verlet&quot;</span><span class="p">,</span>
        <span class="n">rotation_integrator_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">domain_type</span><span class="o">=</span><span class="s2">&quot;periodic&quot;</span><span class="p">,</span>
        <span class="n">force_model_type</span><span class="o">=</span><span class="s2">&quot;spring&quot;</span><span class="p">,</span>
        <span class="n">collider_type</span><span class="o">=</span><span class="s2">&quot;naive&quot;</span><span class="p">,</span>
        <span class="n">mat_table</span><span class="o">=</span><span class="n">mat_table</span><span class="p">,</span>
        <span class="n">domain_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">box_size</span><span class="o">=</span><span class="n">box_size</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">system</span>
</pre></div>
</div>
</section>
<section id="run-dynamics-while-imposing-a-sine-wave-compression">
<h1>Run dynamics while imposing a sine-wave compression<a class="headerlink" href="#run-dynamics-while-imposing-a-sine-wave-compression" title="Link to this heading">#</a></h1>
<p>We impose a single-period sinusoidal modulation of the packing fraction over the
protocol duration (a compression/decompression cycle). We intentionally do <strong>not</strong>
set a temperature schedule here, so temperature is free to fluctuate.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">initial_temperature</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">packing_fraction_amplitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">save_stride</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_snapshots</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span> <span class="o">//</span> <span class="nb">int</span><span class="p">(</span><span class="n">save_stride</span><span class="p">)</span>

<span class="n">state</span><span class="p">,</span> <span class="n">system</span> <span class="o">=</span> <span class="n">build_microstate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">thermal</span><span class="o">.</span><span class="n">set_temperature</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">initial_temperature</span><span class="p">,</span> <span class="n">can_rotate</span><span class="o">=</span><span class="n">can_rotate</span><span class="p">,</span> <span class="n">subtract_drift</span><span class="o">=</span><span class="n">subtract_drift</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">sine_dens_schedule</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 0..1</span>
    <span class="k">return</span> <span class="n">start</span> <span class="o">+</span> <span class="n">packing_fraction_amplitude</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># one full period</span>

<span class="n">state</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="p">(</span><span class="n">traj_state</span><span class="p">,</span> <span class="n">traj_system</span><span class="p">)</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">control_nvt_density_rollout</span><span class="p">(</span>
    <span class="n">state</span><span class="p">,</span>
    <span class="n">system</span><span class="p">,</span>
    <span class="n">n</span><span class="o">=</span><span class="n">n_snapshots</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="n">save_stride</span><span class="p">,</span>
    <span class="n">rescale_every</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="c1"># NOTE: Density control is enabled when either packing_fraction_target or</span>
    <span class="c1"># packing_fraction_delta is provided. Our schedule ignores the &quot;target&quot;, so we</span>
    <span class="c1"># pass delta=0.0 simply to enable control.</span>
    <span class="n">packing_fraction_delta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">density_schedule</span><span class="o">=</span><span class="n">sine_dens_schedule</span><span class="p">,</span>
    <span class="n">can_rotate</span><span class="o">=</span><span class="n">can_rotate</span><span class="p">,</span>
    <span class="n">subtract_drift</span><span class="o">=</span><span class="n">subtract_drift</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">temperature</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">thermal</span><span class="o">.</span><span class="n">compute_temperature</span><span class="p">,</span> <span class="n">can_rotate</span><span class="o">=</span><span class="n">can_rotate</span><span class="p">,</span> <span class="n">subtract_drift</span><span class="o">=</span><span class="n">subtract_drift</span><span class="p">))(</span><span class="n">traj_state</span><span class="p">)</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">packingUtils</span><span class="o">.</span><span class="n">compute_packing_fraction</span><span class="p">))(</span><span class="n">traj_state</span><span class="p">,</span> <span class="n">traj_system</span><span class="p">)</span>
<span class="n">pe</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">jd</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">thermal</span><span class="o">.</span><span class="n">compute_potential_energy</span><span class="p">))(</span><span class="n">traj_state</span><span class="p">,</span> <span class="n">traj_system</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The recorded temperature profile is: &#39;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The recorded density profile is: &#39;</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The recorded potential-energy profile is: &#39;</span><span class="p">,</span> <span class="n">pe</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>The recorded temperature profile is:  [9.33094880e-05 8.54299606e-05 7.92524407e-05 8.20803919e-05
 8.03058175e-05 7.47673854e-05 7.28302215e-05 6.88730304e-05
 6.88260067e-05 6.84916193e-05 6.46841546e-05 6.32966682e-05
 6.02580825e-05 6.22173641e-05 6.12192442e-05 6.14830213e-05
 5.78662698e-05 5.91876929e-05 5.79813470e-05 5.87028133e-05
 5.76878835e-05 5.62916500e-05 5.44034181e-05 5.68672405e-05
 5.47027158e-05 5.57097421e-05 5.66834385e-05 5.56166591e-05
 5.43716042e-05 5.63501712e-05 5.73616693e-05 5.80161530e-05
 5.80360636e-05 5.98364010e-05 5.82441273e-05 6.24505974e-05
 6.34642374e-05 6.46894773e-05 6.89427242e-05 6.61038315e-05
 7.68571387e-05 8.04094459e-05 8.25110437e-05 8.42384683e-05
 9.65663115e-05 9.76201259e-05 9.65047239e-05 1.07747395e-04
 1.06847420e-04 1.24332693e-04 1.20392706e-04 1.06917759e-04
 1.32589163e-04 1.44302912e-04 1.58059136e-04 1.53538712e-04
 1.64589427e-04 1.68039739e-04 1.73181837e-04 1.82230499e-04
 1.91113632e-04 1.79369924e-04 2.01646374e-04 1.93249082e-04
 1.95918536e-04 2.11428481e-04 2.11015468e-04 2.25335581e-04
 2.34052620e-04 2.28650407e-04 2.33119047e-04 2.50956933e-04
 2.40704451e-04 2.48065738e-04 2.38804493e-04 2.58868263e-04
 2.31551259e-04 2.51513230e-04 2.55727586e-04 2.46193591e-04
 2.39233619e-04 2.50534961e-04 2.48516603e-04 2.30711919e-04
 2.11763392e-04 2.20826807e-04 2.25878088e-04 2.15812261e-04
 2.10747852e-04 2.05534982e-04 1.89852405e-04 1.93547179e-04
 1.81418717e-04 1.82200193e-04 1.79665174e-04 1.68763432e-04
 1.68375303e-04 1.65295054e-04 1.47087529e-04 1.44035309e-04]
The recorded density profile is:  [0.69686047 0.69373334 0.69063093 0.68756551 0.68454915 0.68159377
 0.67871104 0.67591232 0.67320866 0.67061074 0.6681288  0.66577264
 0.66355157 0.66147434 0.65954915 0.6577836  0.65618467 0.65475865
 0.65351118 0.65244717 0.65157084 0.65088564 0.65039426 0.65009866
 0.65       0.65009866 0.65039426 0.65088564 0.65157084 0.65244717
 0.65351118 0.65475865 0.65618467 0.6577836  0.65954915 0.66147434
 0.66355157 0.66577264 0.6681288  0.67061074 0.67320866 0.67591232
 0.67871104 0.68159377 0.68454915 0.68756551 0.69063093 0.69373334
 0.69686047 0.7        0.70313953 0.70626666 0.70936907 0.71243449
 0.71545085 0.71840623 0.72128896 0.72408768 0.72679134 0.72938926
 0.7318712  0.73422736 0.73644843 0.73852566 0.74045085 0.7422164
 0.74381533 0.74524135 0.74648882 0.74755283 0.74842916 0.74911436
 0.74960574 0.74990134 0.75       0.74990134 0.74960574 0.74911436
 0.74842916 0.74755283 0.74648882 0.74524135 0.74381533 0.7422164
 0.74045085 0.73852566 0.73644843 0.73422736 0.7318712  0.72938926
 0.72679134 0.72408768 0.72128896 0.71840623 0.71545085 0.71243449
 0.70936907 0.70626666 0.70313953 0.7       ]
The recorded potential-energy profile is:  [3.88969557e-04 6.70618384e-04 7.73829276e-04 2.78877300e-04
 2.04135159e-04 4.69208843e-04 4.22557970e-04 5.32432893e-04
 2.85927967e-04 1.56704030e-04 3.17987822e-04 2.84772328e-04
 4.53435619e-04 1.57670761e-04 1.80266617e-04 8.05369632e-05
 3.18523630e-04 1.24708923e-04 1.80375335e-04 7.99434744e-05
 1.44568309e-04 2.40849454e-04 3.84671129e-04 1.27968354e-04
 3.35431622e-04 2.41481662e-04 1.55949524e-04 2.96404350e-04
 4.89880427e-04 3.55546019e-04 3.29331659e-04 3.63363003e-04
 4.80349272e-04 4.39836152e-04 8.28276173e-04 6.43951856e-04
 8.18779692e-04 1.02876840e-03 9.33525598e-04 1.71130993e-03
 1.06247530e-03 1.13495653e-03 1.49037768e-03 1.91289714e-03
 1.08687248e-03 1.39110820e-03 2.10523769e-03 1.53595136e-03
 2.38418070e-03 1.10687141e-03 2.13864711e-03 4.49425970e-03
 2.94673838e-03 2.57624700e-03 1.78849918e-03 2.94655913e-03
 2.60440874e-03 3.01231656e-03 3.35075680e-03 3.15564129e-03
 2.88303535e-03 4.97897966e-03 3.57014286e-03 5.29044353e-03
 5.97484450e-03 5.19426529e-03 5.97341726e-03 5.26937424e-03
 4.88784626e-03 5.91549957e-03 5.87366757e-03 4.38652813e-03
 5.62865790e-03 5.03027252e-03 5.99305802e-03 3.96828265e-03
 6.52836573e-03 4.34066323e-03 3.67954250e-03 4.27079426e-03
 4.57087994e-03 3.07606986e-03 2.87676407e-03 4.05687824e-03
 5.14636436e-03 3.56317729e-03 2.52290993e-03 2.87423814e-03
 2.64808066e-03 2.48493170e-03 3.26968822e-03 2.15473684e-03
 2.54610752e-03 1.83347849e-03 1.53444991e-03 2.02834741e-03
 1.54556215e-03 1.23564537e-03 2.28640783e-03 1.92976103e-03]
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 7.194 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-temperature-density-control-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/4eafbc72d180a0151ea3f96c94188538/temperature_density_control.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">temperature_density_control.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/b77ec84a1f96683af3e7818c51d0de80/temperature_density_control.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">temperature_density_control.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/bc3a4b4b3b7144105dd2be9720288ce5/temperature_density_control.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">temperature_density_control.zip</span></code></a></p>
</div>
</div>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Imports</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-dynamics-while-imposing-a-sine-wave-compression">Run dynamics while imposing a sine-wave compression</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2026, Carlos Andres del Valle.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.1.0.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>